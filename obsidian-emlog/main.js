/*
THIS IS A GENERATED/BUNDLED FILE BY ESBUILD
if you want to view the source, please visit the github repository of this plugin
*/

var ut=Object.create;var U=Object.defineProperty;var gt=Object.getOwnPropertyDescriptor;var dt=Object.getOwnPropertyNames;var ft=Object.getPrototypeOf,mt=Object.prototype.hasOwnProperty;var wt=(k,E)=>()=>(E||k((E={exports:{}}).exports,E),E.exports),yt=(k,E)=>{for(var t in E)U(k,t,{get:E[t],enumerable:!0})},ot=(k,E,t,s)=>{if(E&&typeof E=="object"||typeof E=="function")for(let e of dt(E))!mt.call(k,e)&&e!==t&&U(k,e,{get:()=>E[e],enumerable:!(s=gt(E,e))||s.enumerable});return k};var bt=(k,E,t)=>(t=k!=null?ut(ft(k)):{},ot(E||!k||!k.__esModule?U(t,"default",{value:k,enumerable:!0}):t,k)),St=k=>ot(U({},"__esModule",{value:!0}),k);var ct=wt((lt,x)=>{(function(k){"use strict";function E(n,m){var a=(n&65535)+(m&65535),v=(n>>16)+(m>>16)+(a>>16);return v<<16|a&65535}function t(n,m){return n<<m|n>>>32-m}function s(n,m,a,v,P,$){return E(t(E(E(m,n),E(v,$)),P),a)}function e(n,m,a,v,P,$,C){return s(m&a|~m&v,n,m,P,$,C)}function i(n,m,a,v,P,$,C){return s(m&v|a&~v,n,m,P,$,C)}function r(n,m,a,v,P,$,C){return s(m^a^v,n,m,P,$,C)}function o(n,m,a,v,P,$,C){return s(a^(m|~v),n,m,P,$,C)}function d(n,m){n[m>>5]|=128<<m%32,n[(m+64>>>9<<4)+14]=m;var a,v,P,$,C,h=1732584193,p=-271733879,u=-1732584194,g=271733878;for(a=0;a<n.length;a+=16)v=h,P=p,$=u,C=g,h=e(h,p,u,g,n[a],7,-680876936),g=e(g,h,p,u,n[a+1],12,-389564586),u=e(u,g,h,p,n[a+2],17,606105819),p=e(p,u,g,h,n[a+3],22,-1044525330),h=e(h,p,u,g,n[a+4],7,-176418897),g=e(g,h,p,u,n[a+5],12,1200080426),u=e(u,g,h,p,n[a+6],17,-1473231341),p=e(p,u,g,h,n[a+7],22,-45705983),h=e(h,p,u,g,n[a+8],7,1770035416),g=e(g,h,p,u,n[a+9],12,-1958414417),u=e(u,g,h,p,n[a+10],17,-42063),p=e(p,u,g,h,n[a+11],22,-1990404162),h=e(h,p,u,g,n[a+12],7,1804603682),g=e(g,h,p,u,n[a+13],12,-40341101),u=e(u,g,h,p,n[a+14],17,-1502002290),p=e(p,u,g,h,n[a+15],22,1236535329),h=i(h,p,u,g,n[a+1],5,-165796510),g=i(g,h,p,u,n[a+6],9,-1069501632),u=i(u,g,h,p,n[a+11],14,643717713),p=i(p,u,g,h,n[a],20,-373897302),h=i(h,p,u,g,n[a+5],5,-701558691),g=i(g,h,p,u,n[a+10],9,38016083),u=i(u,g,h,p,n[a+15],14,-660478335),p=i(p,u,g,h,n[a+4],20,-405537848),h=i(h,p,u,g,n[a+9],5,568446438),g=i(g,h,p,u,n[a+14],9,-1019803690),u=i(u,g,h,p,n[a+3],14,-187363961),p=i(p,u,g,h,n[a+8],20,1163531501),h=i(h,p,u,g,n[a+13],5,-1444681467),g=i(g,h,p,u,n[a+2],9,-51403784),u=i(u,g,h,p,n[a+7],14,1735328473),p=i(p,u,g,h,n[a+12],20,-1926607734),h=r(h,p,u,g,n[a+5],4,-378558),g=r(g,h,p,u,n[a+8],11,-2022574463),u=r(u,g,h,p,n[a+11],16,1839030562),p=r(p,u,g,h,n[a+14],23,-35309556),h=r(h,p,u,g,n[a+1],4,-1530992060),g=r(g,h,p,u,n[a+4],11,1272893353),u=r(u,g,h,p,n[a+7],16,-155497632),p=r(p,u,g,h,n[a+10],23,-1094730640),h=r(h,p,u,g,n[a+13],4,681279174),g=r(g,h,p,u,n[a],11,-358537222),u=r(u,g,h,p,n[a+3],16,-722521979),p=r(p,u,g,h,n[a+6],23,76029189),h=r(h,p,u,g,n[a+9],4,-640364487),g=r(g,h,p,u,n[a+12],11,-421815835),u=r(u,g,h,p,n[a+15],16,530742520),p=r(p,u,g,h,n[a+2],23,-995338651),h=o(h,p,u,g,n[a],6,-198630844),g=o(g,h,p,u,n[a+7],10,1126891415),u=o(u,g,h,p,n[a+14],15,-1416354905),p=o(p,u,g,h,n[a+5],21,-57434055),h=o(h,p,u,g,n[a+12],6,1700485571),g=o(g,h,p,u,n[a+3],10,-1894986606),u=o(u,g,h,p,n[a+10],15,-1051523),p=o(p,u,g,h,n[a+1],21,-2054922799),h=o(h,p,u,g,n[a+8],6,1873313359),g=o(g,h,p,u,n[a+15],10,-30611744),u=o(u,g,h,p,n[a+6],15,-1560198380),p=o(p,u,g,h,n[a+13],21,1309151649),h=o(h,p,u,g,n[a+4],6,-145523070),g=o(g,h,p,u,n[a+11],10,-1120210379),u=o(u,g,h,p,n[a+2],15,718787259),p=o(p,u,g,h,n[a+9],21,-343485551),h=E(h,v),p=E(p,P),u=E(u,$),g=E(g,C);return[h,p,u,g]}function b(n){var m,a="",v=n.length*32;for(m=0;m<v;m+=8)a+=String.fromCharCode(n[m>>5]>>>m%32&255);return a}function S(n){var m,a=[];for(a[(n.length>>2)-1]=void 0,m=0;m<a.length;m+=1)a[m]=0;var v=n.length*8;for(m=0;m<v;m+=8)a[m>>5]|=(n.charCodeAt(m/8)&255)<<m%32;return a}function c(n){return b(d(S(n),n.length*8))}function l(n,m){var a,v=S(n),P=[],$=[],C;for(P[15]=$[15]=void 0,v.length>16&&(v=d(v,n.length*8)),a=0;a<16;a+=1)P[a]=v[a]^909522486,$[a]=v[a]^1549556828;return C=d(P.concat(S(m)),512+m.length*8),b(d($.concat(C),512+128))}function w(n){var m="0123456789abcdef",a="",v,P;for(P=0;P<n.length;P+=1)v=n.charCodeAt(P),a+=m.charAt(v>>>4&15)+m.charAt(v&15);return a}function T(n){return unescape(encodeURIComponent(n))}function I(n){return c(T(n))}function O(n){return w(I(n))}function D(n,m){return l(T(n),T(m))}function R(n,m){return w(D(n,m))}function _(n,m,a){return m?a?D(m,n):R(m,n):a?I(n):O(n)}typeof define=="function"&&define.amd?define(function(){return _}):typeof x=="object"&&x.exports?x.exports=_:k.md5=_})(lt)});var Tt={};yt(Tt,{default:()=>N});module.exports=St(Tt);var f=require("obsidian"),F=bt(ct()),L,ht,pt;try{L=(pt=(ht=require("electron"))==null?void 0:ht.shell)==null?void 0:pt.openExternal}catch(k){}var V={baseUrl:"",authMode:"sign",apiKey:"",defaultAuthorUid:"",defaultSortId:"",defaultDraft:!0,autoCover:!0,allowRemark:!0,postAction:"open",enableDebug:!1},G="emlog-panel",N=class extends f.Plugin{constructor(){super(...arguments);this.articleMap={};this.statusEl=null;this.cachedSorts=[];this.lastMarkdownFile=null}async onload(){await this.loadSettings(),this.statusEl=this.addStatusBarItem(),this.setStatus("\u5C31\u7EEA"),this.registerEvent(this.app.workspace.on("active-leaf-change",t=>{let s=t==null?void 0:t.view;s&&s.file&&s instanceof f.MarkdownView&&(this.lastMarkdownFile=s.file)})),this.registerView(G,t=>new K(t,this)),this.addRibbonIcon("dice","\u6253\u5F00 EMLOG \u9762\u677F",()=>{this.activatePanelView()}),this.addCommand({id:"emlog-open-panel",name:"\u6253\u5F00/\u5207\u6362 EMLOG \u9762\u677F",callback:()=>this.activatePanelView()}),this.addCommand({id:"emlog-publish-current",name:"\u53D1\u5E03\u5F53\u524D\u7B14\u8BB0\u5230 EMLOG",callback:()=>this.publishCurrentNote(!1)}),this.addCommand({id:"emlog-publish-draft",name:"\u53D1\u5E03\u4E3A\u8349\u7A3F\u5230 EMLOG",callback:()=>this.publishCurrentNote(!0)}),this.addCommand({id:"emlog-publish-note",name:"\u53D1\u5E03\u5FAE\u8BED\uFF08\u5F53\u524D\u9009\u4E2D\u6587\u672C\u6216\u63D0\u793A\u8F93\u5165\uFF09",callback:()=>this.publishNote()}),this.addCommand({id:"emlog-publish-custom",name:"\u81EA\u5B9A\u4E49\u53D1\u5E03\u2026",callback:()=>{var s,e;let t=((s=this.app.workspace.getActiveViewOfType(f.MarkdownView))==null?void 0:s.file)||this.lastMarkdownFile;if(!t){new f.Notice("\u672A\u68C0\u6D4B\u5230 Markdown \u6587\u4EF6");return}new f.Notice("\u6253\u5F00\u81EA\u5B9A\u4E49\u53D1\u5E03\u7A97\u53E3\u2026"),this.openPublishModal(t,(e=this.app.workspace.getActiveViewOfType(f.MarkdownView))==null?void 0:e.editor)}}),this.registerEvent(this.app.workspace.on("editor-menu",(t,s,e)=>{e!=null&&e.file&&(t.addItem(i=>i.setTitle("\u53D1\u5E03\u5230 EMLOG\uFF08\u6B63\u5F0F\uFF09").setIcon("paper-plane").onClick(()=>this.publishFromContext(s,e,!1))),t.addItem(i=>i.setTitle("\u53D1\u5E03\u5230 EMLOG\uFF08\u8349\u7A3F\uFF09").setIcon("paper-plane").onClick(()=>this.publishFromContext(s,e,!0))),t.addItem(i=>i.setTitle("\u81EA\u5B9A\u4E49\u53D1\u5E03\u2026").setIcon("forms").onClick(()=>this.openPublishModal(e.file||this.lastMarkdownFile))),t.addSeparator(),t.addItem(i=>i.setTitle("\u53D1\u5E03\u5FAE\u8BED\uFF08\u9009\u4E2D\u6587\u672C\uFF09").setIcon("message-square").onClick(async()=>{var o;let r=s.getSelection();if(!r){new f.Notice("\u8BF7\u9009\u62E9\u8981\u53D1\u5E03\u4E3A\u5FAE\u8BED\u7684\u6587\u672C");return}try{await this.httpForm("note_post",{t:r}),new f.Notice("\u5FAE\u8BED\u53D1\u5E03\u6210\u529F")}catch(d){new f.Notice(`\u5FAE\u8BED\u53D1\u5E03\u5931\u8D25\uFF1A${(o=d.message)!=null?o:d}`)}})))})),this.registerEvent(this.app.workspace.on("file-menu",(t,s)=>{!(s instanceof f.TFile)||s.extension!=="md"||(t.addItem(e=>e.setTitle("\u53D1\u5E03\u5230 EMLOG\uFF08\u6B63\u5F0F\uFF09").setIcon("paper-plane").onClick(async()=>{let i=await this.app.vault.cachedRead(s);await this.publishCore(s,i,!1,{})})),t.addItem(e=>e.setTitle("\u53D1\u5E03\u5230 EMLOG\uFF08\u8349\u7A3F\uFF09").setIcon("paper-plane").onClick(async()=>{let i=await this.app.vault.cachedRead(s);await this.publishCore(s,i,!0,{})})),t.addItem(e=>e.setTitle("\u81EA\u5B9A\u4E49\u53D1\u5E03\u2026").setIcon("forms").onClick(()=>this.openPublishModal(s))))})),this.addSettingTab(new H(this.app,this))}onunload(){}async loadSettings(){let t=await this.loadData();if(!t){this.settings={...V},this.articleMap={};return}t.settings?(this.settings={...V,...t.settings},this.articleMap=t.articleMap||{}):(this.settings={...V,...t},this.articleMap={})}async saveState(){let t={settings:this.settings,articleMap:this.articleMap};await this.saveData(t)}async saveSettings(){await this.saveState()}setStatus(t){this.statusEl&&this.statusEl.setText(`EMLOG: ${t}`)}debug(...t){if(!this.settings.enableDebug)return;let s=e=>{try{if(typeof e=="string")return this.redactString(e);if(typeof e=="object"&&e!==null){let i=JSON.stringify(e);return this.redactString(i)}return e}catch(i){return e}};try{console.debug("[obsidian-emlog]",...t.map(s))}catch(e){}}redactString(t){let s=t;if(this.settings.apiKey){let e=this.escapeRegExp(this.settings.apiKey);s=s.replace(new RegExp(e,"g"),"***")}return s=s.replace(/"req_sign"\s*:\s*"[a-fA-F0-9]{16,}"/g,'"req_sign":"***"'),s}getActiveMarkdown(){let t=this.app.workspace.getActiveViewOfType(f.MarkdownView);return t!=null&&t.file?{editor:t.editor,view:t,file:t.file}:this.lastMarkdownFile?{file:this.lastMarkdownFile}:(new f.Notice("\u672A\u627E\u5230\u6D3B\u52A8\u7684 Markdown \u7A97\u53E3"),null)}deriveTitle(t,s,e){if(e!=null&&e.title)return String(e.title);if(s!=null&&s.basename)return s.basename;let i=t.split(`
`);for(let r of i){let o=r.trim();if(o.startsWith("# "))return o.substring(2).trim()}return"\u65E0\u6807\u9898\u6587\u7AE0"}deriveExcerpt(t,s){if(s!=null&&s.excerpt)return String(s.excerpt);let e=t;if(e.startsWith(`---
`)){let o=e.indexOf(`
---
`,4);o!==-1&&(e=e.substring(o+5))}let r=e.split(`
`).filter(o=>{let d=o.trim();return d&&!d.startsWith("#")}).join(" ").replace(/!\[.*?\]\(.*?\)/g,"").trim();return r.length>150?r.substring(0,150)+"...":r}extractFrontmatter(t){let s=this.app.metadataCache.getFileCache(t);return s==null?void 0:s.frontmatter}removeFromContent(t){if(!t.startsWith(`---
`))return t;let s=t.indexOf(`
---
`,4);return s===-1?t:t.substring(s+5)}async publishCore(t,s,e,i){var v,P,$,C,h,p,u,g,B,j,J,W,Y,X,z,Q,Z,tt,et,st,it,nt,at,rt;let r=this.extractFrontmatter(t)||{},o=this.deriveTitle(s,t,r),d=(v=i.title)!=null?v:o,b=this.deriveExcerpt(s,r),S=(P=i.excerpt)!=null?P:b,c=($=i.tags)!=null?$:Array.isArray(r.tags)?r.tags.map(String).join(","):typeof r.tags=="string"?r.tags:"",l=(p=i.sortId)!=null?p:((C=r.sort_id)!=null?C:this.settings.defaultSortId)?String((h=r.sort_id)!=null?h:this.settings.defaultSortId):"",w=((u=r.author_uid)!=null?u:this.settings.defaultAuthorUid)?String((g=r.author_uid)!=null?g:this.settings.defaultAuthorUid):"",T=i.postDate,I=(B=i.coverImage)!=null?B:r.cover_image||r.coverImage||"",O=e?!0:i.draft!=null?i.draft:r.draft==="y"||r.draft===!0,D=(j=i.top)!=null?j:r.top==="y"||r.top===!0?"y":"n",R=(J=i.sortop)!=null?J:r.sortop==="y"||r.sortop===!0?"y":"n",_=(W=i.allowRemark)!=null?W:r.allow_remark==="n"||r.allow_remark===!1?"n":"y",n=(X=(Y=i.password)!=null?Y:r.password)!=null?X:"";this.setStatus("\u4E0A\u4F20\u56FE\u7247\u4E2D...");let m=this.removeFromContent(s);try{m=(await this.processImages(m,t)).content}catch(y){this.debug("\u5904\u7406\u56FE\u7247\u5931\u8D25",(z=y==null?void 0:y.message)!=null?z:String(y))}let a=this.articleMap[t.path]!=null;this.setStatus(a?"\u66F4\u65B0\u6587\u7AE0\u4E2D...":"\u53D1\u5E03\u6587\u7AE0\u4E2D..."),new f.Notice(a?"\u6B63\u5728\u66F4\u65B0\u5230 EMLOG...":"\u6B63\u5728\u53D1\u5E03\u5230 EMLOG..."),this.debug("\u5F00\u59CB\u53D1\u5E03\u6587\u7AE0",{isUpdate:a,title:d,contentLength:m.length,sortId:l,tags:c,draftFlag:O,authMode:this.settings.authMode,baseUrl:this.settings.baseUrl});try{if(a){let y=Number(this.articleMap[t.path]);await this.httpForm("article_update",{id:String(y),title:d,content:m,excerpt:S,...c?{tags:c}:{},...l?{sort_id:l}:{},...w?{author_uid:w}:{},draft:O?"y":"n",...T?{post_date:T}:{},...I?{cover:I}:{},top:D,sortop:R,allow_remark:_,...n?{password:n}:{}}),new f.Notice(`\u66F4\u65B0\u6210\u529F\uFF1A${d} (ID: ${y})`),this.setStatus("\u66F4\u65B0\u6210\u529F"),await this.performPostAction(y,O);let M=await this.fetchArticleUrlById(y);await this.upsertFrontmatterKeys(t,{published:!O,sort_id:l||((Q=r.sort_id)!=null?Q:""),emlog_article_id:y,publish_date:this.formatDate(),url:M||""})}else{let y=await this.httpForm("article_post",{title:d,content:m,excerpt:S,...c?{tags:c}:{},...l?{sort_id:l}:{},...w?{author_uid:w}:{},draft:O?"y":"n",allow_remark:_,auto_cover:this.settings.autoCover?"y":"n",...T?{post_date:T}:{},...I?{cover:I}:{},top:D,sortop:R,...n?{password:n}:{}}),M=((Z=y==null?void 0:y.data)==null?void 0:Z.article_id)||(y==null?void 0:y.article_id);this.debug("\u53D1\u5E03\u54CD\u5E94\u6570\u636E",{data:y,articleId:M}),M&&(this.articleMap[t.path]=M,await this.saveState()),new f.Notice(`\u53D1\u5E03\u6210\u529F\uFF1A${d} (ID: ${M!=null?M:"\u672A\u77E5"})`),this.setStatus("\u53D1\u5E03\u6210\u529F"),await this.performPostAction(M!=null?M:null,O);let A=M?await this.fetchArticleUrlById(M):null;await this.upsertFrontmatterKeys(t,{published:!O,sort_id:l||((tt=r.sort_id)!=null?tt:""),emlog_article_id:M||"",publish_date:this.formatDate(),url:A||""})}}catch(y){let M={message:(y==null?void 0:y.message)||String(y),stack:y==null?void 0:y.stack,name:y==null?void 0:y.name,cause:y==null?void 0:y.cause,response:y==null?void 0:y.response,status:y==null?void 0:y.status,statusText:y==null?void 0:y.statusText};this.debug("\u53D1\u5E03\u5931\u8D25\u8BE6\u7EC6\u4FE1\u606F",M);let A=`\u53D1\u5E03\u5931\u8D25\uFF1A${(et=y.message)!=null?et:y}`;(st=y==null?void 0:y.message)!=null&&st.includes("401")?A+=`
\u{1F511} \u8BA4\u8BC1\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5 API Key \u548C\u8BA4\u8BC1\u65B9\u5F0F\u8BBE\u7F6E`:(it=y==null?void 0:y.message)!=null&&it.includes("404")?A+=`
\u{1F310} API \u8DEF\u5F84\u4E0D\u6B63\u786E\uFF0C\u8BF7\u68C0\u67E5\u535A\u5BA2\u5730\u5740\u914D\u7F6E`:(nt=y==null?void 0:y.message)!=null&&nt.includes("timeout")?A+=`
\u23F1\uFE0F \u8BF7\u6C42\u8D85\u65F6\uFF0C\u8BF7\u68C0\u67E5\u7F51\u7EDC\u8FDE\u63A5`:(at=y==null?void 0:y.message)!=null&&at.includes("CORS")?A+=`
\u{1F6AB} \u8DE8\u57DF\u8BF7\u6C42\u88AB\u963B\u6B62\uFF0C\u8FD9\u662F\u6D4F\u89C8\u5668\u5B89\u5168\u9650\u5236`:(rt=y==null?void 0:y.message)!=null&&rt.includes("Request failed")&&(A+=`
\u{1F4E1} \u7F51\u7EDC\u8BF7\u6C42\u5931\u8D25\uFF0C\u8BF7\u68C0\u67E5\u535A\u5BA2\u5730\u5740\u548C\u7F51\u7EDC\u8FDE\u63A5`),new f.Notice(A,1e4),this.setStatus("\u5931\u8D25")}}async publishFromContext(t,s,e){var o;let i=s==null?void 0:s.file;if(!i){new f.Notice("\u672A\u68C0\u6D4B\u5230 Markdown \u6587\u4EF6");return}let r=(o=t==null?void 0:t.getValue())!=null?o:await this.app.vault.cachedRead(i);await this.publishCore(i,r,e,{})}async publishCurrentNote(t){let s=this.getActiveMarkdown();if(!s)return;let{editor:e,file:i}=s,r=e?e.getValue():await this.app.vault.cachedRead(i);await this.publishCore(i,r,t,{})}async publishNote(){var i,r;let t="",s,e=this.app.workspace.getActiveViewOfType(f.MarkdownView);if(e!=null&&e.editor&&(s=e.editor,t=s.getSelection()),!t&&this.lastMarkdownFile){let o=this.app.workspace.getLeavesOfType("markdown").find(d=>{var S,c;let b=d.view;return((S=b==null?void 0:b.file)==null?void 0:S.path)===((c=this.lastMarkdownFile)==null?void 0:c.path)});if(o){let d=o.view;d!=null&&d.editor&&(s=d.editor,t=s.getSelection())}}if(!t){new f.Notice("\u8BF7\u9009\u62E9\u8981\u53D1\u5E03\u4E3A\u5FAE\u8BED\u7684\u6587\u672C");return}this.debug("\u53D1\u5E03\u5FAE\u8BED",{textLength:t.length,textPreview:t.substring(0,50)}),this.setStatus("\u53D1\u5E03\u5FAE\u8BED\u4E2D...");try{await this.httpForm("note_post",{t}),new f.Notice("\u5FAE\u8BED\u53D1\u5E03\u6210\u529F"),this.setStatus("\u5FAE\u8BED\u5DF2\u53D1\u5E03")}catch(o){new f.Notice(`\u5FAE\u8BED\u53D1\u5E03\u5931\u8D25\uFF1A${(i=o.message)!=null?i:o}`),this.setStatus("\u5931\u8D25"),this.debug("\u5FAE\u8BED\u5931\u8D25",(r=o==null?void 0:o.message)!=null?r:String(o))}}async activatePanelView(){let t=this.app.workspace.getRightLeaf(!1);if(t||(t=this.app.workspace.getRightLeaf(!0)),!t){new f.Notice("\u65E0\u6CD5\u6253\u5F00\u53F3\u4FA7\u9762\u677F");return}await t.setViewState({type:G,active:!0}),this.app.workspace.revealLeaf(t)}openPublishModal(t,s){if(!t){new f.Notice("\u672A\u627E\u5230\u8981\u53D1\u5E03\u7684 Markdown \u6587\u4EF6");return}new q(this.app,this,t,s).open()}async fetchArticleUrlById(t){var s,e,i,r;try{let o=await this.httpGet("article_detail",{id:String(t)}),d=((e=(s=o==null?void 0:o.data)==null?void 0:s.article)==null?void 0:e.url)||((i=o==null?void 0:o.article)==null?void 0:i.url);if(d)return d;let S=`${this.settings.baseUrl.replace(/\/$/,"")}/?post=${t}`;return this.debug("\u6784\u9020\u6587\u7AE0 URL",{id:t,constructedUrl:S}),S}catch(o){return this.debug("\u83B7\u53D6\u6587\u7AE0 URL \u5931\u8D25\uFF0C\u4F7F\u7528\u6784\u9020\u7684 URL",(r=o==null?void 0:o.message)!=null?r:String(o)),`${this.settings.baseUrl.replace(/\/$/,"")}/?post=${t}`}}async performPostAction(t,s){var r,o;if(s){new f.Notice("\u8349\u7A3F\u5DF2\u4FDD\u5B58\uFF08\u8349\u7A3F\u65E0\u516C\u5F00\u94FE\u63A5\uFF09");return}if(!t)return;let e=this.settings.postAction;if(e==="none")return;let i=await this.fetchArticleUrlById(t);if(i){if(e==="open"||e==="both")try{L?L(i):window.open(i,"_blank")}catch(d){window.open(i,"_blank")}if(e==="copy"||e==="both")try{await((o=(r=navigator.clipboard)==null?void 0:r.writeText)==null?void 0:o.call(r,i)),new f.Notice("\u6587\u7AE0\u94FE\u63A5\u5DF2\u590D\u5236")}catch(d){}}}flattenSorts(t,s=0){var i,r,o,d;let e=[];for(let b of t){let S=Number((r=(i=b.sid)!=null?i:b.id)!=null?r:b.sort_id),c=String((d=(o=b.sortname)!=null?o:b.name)!=null?d:"\u672A\u547D\u540D");e.push({id:S,name:c,depth:s}),Array.isArray(b.children)&&b.children.length>0&&e.push(...this.flattenSorts(b.children,s+1))}return e}async refreshSortOptions(){var t,s;try{let e=await this.httpGet("sort_list",{}),i=Array.isArray((t=e==null?void 0:e.data)==null?void 0:t.sorts)?e.data.sorts:Array.isArray(e==null?void 0:e.sorts)?e.sorts:[];this.cachedSorts=this.flattenSorts(i),this.debug("\u5206\u7C7B\u5DF2\u5237\u65B0",this.cachedSorts.length,"\u4E2A\u5206\u7C7B"),new f.Notice(`\u5DF2\u5237\u65B0 ${this.cachedSorts.length} \u4E2A\u5206\u7C7B`)}catch(e){new f.Notice(`\u83B7\u53D6\u5206\u7C7B\u5931\u8D25\uFF1A${(s=e.message)!=null?s:e}`),this.cachedSorts=[]}}populateSortDropdown(t){if(t.selectEl.textContent="",t.addOption("","\uFF08\u4E0D\u6307\u5B9A\uFF09"),!this.cachedSorts.length){t.addOption("__placeholder__",this.settings.baseUrl?"\u5C1A\u672A\u52A0\u8F7D\u5206\u7C7B\uFF0C\u70B9\u51FB\u53F3\u4FA7\u5237\u65B0":"\u8BF7\u5148\u914D\u7F6E\u7AD9\u70B9\u5730\u5740");return}for(let s of this.cachedSorts){let e=" ".repeat(s.depth*2);t.addOption(String(s.id),`${e}${s.name}`)}}getSortNameByIdPublic(t){if(t==null||t==="")return null;let s=Number(t),e=this.cachedSorts.find(i=>i.id===s);return e?e.name:null}formatDate(t=new Date){let s=e=>e.toString().padStart(2,"0");return`${t.getFullYear()}-${s(t.getMonth()+1)}-${s(t.getDate())} ${s(t.getHours())}:${s(t.getMinutes())}:${s(t.getSeconds())}`}async upsertFrontmatterKeys(t,s){let e=this.app.metadataCache.getFileCache(t),i=await this.app.vault.read(t),r=e==null?void 0:e.frontmatterPosition,o=S=>typeof S=="boolean"||typeof S=="number"?String(S):JSON.stringify(String(S)),d=S=>{for(let[c,l]of Object.entries(s)){let w=new RegExp(`^${this.escapeRegExp(c)}s*:s*.*$`,"m");w.test(S)?S=S.replace(w,`${c}: ${o(l)}`):S+=`
${c}: ${o(l)}`}return S},b="";if(r){let S=i.slice(0,r.start.offset),c=i.slice(r.start.offset+4,r.end.offset-4),l=i.slice(r.end.offset),w=d(c);b=`${S}---
${w}
---${l}`}else if(i.startsWith(`---
`)){let S=i.indexOf(`
---`,4);if(S>0){let c=i.slice(4,S),l=i.slice(S+4);b=`---
${d(c)}
---${l}`}}if(!b){let S="";for(let[c,l]of Object.entries(s))S+=`${c}: ${o(l)}
`;b=`---
${S}---
${i}`}await this.app.vault.modify(t,b)}async httpForm(t,s){var b,S,c;let e=this.settings.baseUrl.replace(/\/$/,""),i=`${e}/?rest-api=${t}`,r={...s},o={"Content-Type":"application/x-www-form-urlencoded"};if(t==="article_post"||t==="article_update"||t==="note_post"){let l=Math.floor(Date.now()/1e3).toString();r.req_time=l,r.req_sign=(0,F.default)(l+this.settings.apiKey),this.debug("\u5F3A\u5236\u4F7F\u7528\u7B7E\u540D\u8BA4\u8BC1",{endpoint:t,req_time:l})}else if(this.settings.authMode==="sign"){let l=Math.floor(Date.now()/1e3).toString();r.req_time=l,r.req_sign=(0,F.default)(l+this.settings.apiKey)}else this.settings.authMode==="apikey"?o["X-API-Key"]=this.settings.apiKey:this.settings.authMode==="cookie"&&(o.Cookie=this.settings.apiKey);let d=new URLSearchParams(r).toString();this.debug("HTTP POST",i,"\u53C2\u6570\u957F\u5EA6:",d.length);try{let l=await(0,f.requestUrl)({url:i,method:"POST",headers:o,body:d});if(l.status===200){let w=JSON.parse(l.text);if(w.code===0||w.success)return this.debug("HTTP POST \u6210\u529F",w),w;throw this.debug("HTTP POST \u5931\u8D25",w),new Error(`API \u8C03\u7528\u5931\u8D25: ${w.msg||w.message||JSON.stringify(w)}`)}else throw new Error(`HTTP \u72B6\u6001\u7801: ${l.status}`)}catch(l){this.debug("HTTP POST \u9519\u8BEF\uFF0C\u5C1D\u8BD5\u5907\u7528\u8DEF\u5F84",(b=l==null?void 0:l.message)!=null?b:String(l));let w=`${e}/index.php?rest-api=${t}`;this.debug("HTTP POST \u5907\u7528\u8DEF\u5F84",w);try{let T=await(0,f.requestUrl)({url:w,method:"POST",headers:o,body:d});if(T.status===200){let I=JSON.parse(T.text);if(I.code===0||I.success)return this.debug("HTTP POST \u5907\u7528\u8DEF\u5F84\u6210\u529F",I),I;throw this.debug("HTTP POST \u5907\u7528\u8DEF\u5F84\u5931\u8D25",I),new Error(`API \u8C03\u7528\u5931\u8D25: ${I.msg||I.message||JSON.stringify(I)}`)}else throw new Error(`HTTP \u72B6\u6001\u7801: ${T.status}`)}catch(T){this.debug("HTTP POST \u5907\u7528\u8DEF\u5F84\u4E5F\u5931\u8D25",(S=T==null?void 0:T.message)!=null?S:String(T));let I=`API \u8C03\u7528\u5931\u8D25\uFF0C\u5DF2\u5C1D\u8BD5\u591A\u4E2A\u8DEF\u5F84:
`;throw I+=`\u4E3B\u8DEF\u5F84\u9519\u8BEF: ${l.message}
`,I+=`\u5907\u7528\u8DEF\u5F84\u9519\u8BEF: ${(c=T==null?void 0:T.message)!=null?c:String(T)}
`,I+=`\u8BF7\u6C42\u7684 API: ${t}
`,I+=`\u8BA4\u8BC1\u65B9\u5F0F: ${this.settings.authMode}
`,I+=`\u535A\u5BA2\u5730\u5740: ${e}`,new Error(I)}}}async httpGet(t,s){var d,b,S;let e=this.settings.baseUrl.replace(/\/$/,""),i=new URLSearchParams(s).toString(),r=`${e}/?rest-api=${t}${i?"&"+i:""}`;this.debug("HTTP GET",r);let o={};if(this.settings.authMode==="sign"){let c=Date.now(),l=(0,F.default)(`${c}${this.settings.apiKey}`),w=(0,F.default)(`${c}${l}${this.settings.apiKey}`);o={"X-API-Key":this.settings.apiKey,"X-API-Nonce":l,"X-API-Req-Sign":w,"X-API-Timestamp":String(c)}}else this.settings.authMode==="apikey"?o={"X-API-Key":this.settings.apiKey}:this.settings.authMode==="cookie"&&(o={Cookie:this.settings.apiKey});try{let c=await(0,f.requestUrl)({url:r,method:"GET",headers:o});if(c.status===200){let l=JSON.parse(c.text);if(l.code===0||l.success)return this.debug("HTTP GET \u6210\u529F",l),l;throw this.debug("HTTP GET \u5931\u8D25",l),new Error(`API \u8C03\u7528\u5931\u8D25: ${l.msg||l.message||JSON.stringify(l)}`)}else throw new Error(`HTTP \u72B6\u6001\u7801: ${c.status}`)}catch(c){this.debug("HTTP GET \u9519\u8BEF\uFF0C\u5C1D\u8BD5\u5907\u7528\u8DEF\u5F84",(d=c==null?void 0:c.message)!=null?d:String(c));let l=`${e}/index.php?rest-api=${t}${i?"&"+i:""}`;this.debug("HTTP GET \u5907\u7528\u8DEF\u5F84",l);try{let w=await(0,f.requestUrl)({url:l,method:"GET",headers:o});if(w.status===200){let T=JSON.parse(w.text);if(T.code===0||T.success)return this.debug("HTTP GET \u5907\u7528\u8DEF\u5F84\u6210\u529F",T),T;throw this.debug("HTTP GET \u5907\u7528\u8DEF\u5F84\u5931\u8D25",T),new Error(`API \u8C03\u7528\u5931\u8D25: ${T.msg||T.message||JSON.stringify(T)}`)}else throw new Error(`HTTP \u72B6\u6001\u7801: ${w.status}`)}catch(w){this.debug("HTTP GET \u5907\u7528\u8DEF\u5F84\u4E5F\u5931\u8D25",(b=w==null?void 0:w.message)!=null?b:String(w));let T=`API \u8C03\u7528\u5931\u8D25\uFF0C\u5DF2\u5C1D\u8BD5\u591A\u4E2A\u8DEF\u5F84:
`;throw T+=`\u4E3B\u8DEF\u5F84\u9519\u8BEF: ${c.message}
`,T+=`\u5907\u7528\u8DEF\u5F84\u9519\u8BEF: ${(S=w==null?void 0:w.message)!=null?S:String(w)}
`,T+=`\u8BF7\u6C42\u7684 API: ${t}
`,T+=`\u8BA4\u8BC1\u65B9\u5F0F: ${this.settings.authMode}
`,T+=`\u535A\u5BA2\u5730\u5740: ${e}`,new Error(T)}}}async processImages(t,s){var b,S;let e={},i=/!\[[^\]]*\]\(([^)]+)\)/g,r;for(;(r=i.exec(t))!==null;){let c=r[1].trim();if(/^(https?:)?\/\//i.test(c)||c.startsWith("data:"))continue;let l=this.resolveFile(c,s);if(l)try{let w=await this.uploadBinary(l);e[c]=w}catch(w){this.debug("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25",c,(b=w==null?void 0:w.message)!=null?b:String(w))}}let o=/!\[\[([^\]|]+)(?:\|[^\]]*)?\]\]/g;for(;(r=o.exec(t))!==null;){let c=r[1].trim(),l=this.resolveFile(c,s);if(l)try{let w=await this.uploadBinary(l);e[c]=w}catch(w){this.debug("\u56FE\u7247\u4E0A\u4F20\u5931\u8D25",c,(S=w==null?void 0:w.message)!=null?S:String(w))}}let d=t;for(let[c,l]of Object.entries(e))d=d.replace(new RegExp(`!\\[[^\\]]*\\]\\(
?	?${this.escapeRegExp(c)}\\)`,"g"),w=>w.replace(c,l)),d=d.replace(new RegExp(`!\\[\\[${this.escapeRegExp(c)}(\\|[^\\]]*)?\\]\\]`,"g"),`![](${l})`);return{content:d,uploaded:e}}joinPath(t,s){if(s.startsWith("/"))return s.slice(1);let e=t.substring(0,t.lastIndexOf("/")),i=(e?e+"/":"").concat(s).split("/"),r=[];for(let o of i)if(!(!o||o===".")){if(o===".."){r.pop();continue}r.push(o)}return r.join("/")}resolveFile(t,s){var b;let e=this.app.vault,i=this.joinPath(s.path,t),r=e.getFileByPath(i);if(r||(r=e.getFileByPath(t),r))return r;let o=t.split("/").pop();return o&&(b=this.app.vault.getFiles().filter(S=>S.name===o)[0])!=null?b:null}escapeRegExp(t){return t.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}},H=class extends f.PluginSettingTab{constructor(t,s){super(t,s);this.didRegisterLiveUpdates=!1;this.plugin=s}display(){let{containerEl:t}=this;t.empty(),t.createEl("h2",{text:"obsidian-emlog \u8BBE\u7F6E"}),new f.Setting(t).setName("\u7AD9\u70B9\u5730\u5740").setDesc("\u4F8B\u5982\uFF1Ahttps://yourdomain").addText(d=>d.setPlaceholder("https://yourdomain").setValue(this.plugin.settings.baseUrl).onChange(async b=>{this.plugin.settings.baseUrl=b.trim(),await this.plugin.saveSettings()})),new f.Setting(t).setName("\u9274\u6743\u65B9\u5F0F").setDesc("\u7B7E\u540D\u4F18\u5148\uFF1B\u5F00\u53D1\u53EF\u7528 API Key\uFF1B\u6216\u4F7F\u7528 Cookie").addDropdown(d=>d.addOption("sign","\u7B7E\u540D").addOption("apikey","API Key").addOption("cookie","Cookie").setValue(this.plugin.settings.authMode).onChange(async b=>{this.plugin.settings.authMode=b,await this.plugin.saveSettings()})),new f.Setting(t).setName("API Key").setDesc("\u4EC5\u5728\u514D\u7B7E\u540D\u6216\u7B7E\u540D\u9274\u6743\u4E2D\u4F7F\u7528\uFF1B\u8BF7\u52FF\u6CC4\u9732").addText(d=>d.setPlaceholder("your_api_key").setValue(this.plugin.settings.apiKey).onChange(async b=>{this.plugin.settings.apiKey=b,await this.plugin.saveSettings()})),new f.Setting(t).setName("\u9ED8\u8BA4\u4F5C\u8005 UID").addText(d=>d.setPlaceholder("\u53EF\u7559\u7A7A").setValue(this.plugin.settings.defaultAuthorUid).onChange(async b=>{this.plugin.settings.defaultAuthorUid=b,await this.plugin.saveSettings()}));let s=new f.Setting(t).setName("\u9ED8\u8BA4\u5206\u7C7B").setDesc("\u4ECE\u7AD9\u70B9\u52A8\u6001\u83B7\u53D6\u5206\u7C7B\u5217\u8868\uFF0C\u9009\u62E9\u9ED8\u8BA4\u5206\u7C7B\uFF08\u53EF\u7559\u7A7A\uFF09"),e;s.addDropdown(d=>{e=d,this.plugin.populateSortDropdown(d),d.setValue(this.plugin.settings.defaultSortId||""),d.onChange(async b=>{b!=="__placeholder__"&&(this.plugin.settings.defaultSortId=b,await this.plugin.saveSettings())})}),s.addExtraButton(d=>{d.setIcon("reset").setTooltip("\u5237\u65B0\u5206\u7C7B").onClick(async()=>{d.setDisabled(!0),await this.plugin.refreshSortOptions(),this.plugin.populateSortDropdown(e),e.setValue(this.plugin.settings.defaultSortId||""),o(),d.setDisabled(!1)})});let r=new f.Setting(t).setName("\u5F53\u524D\u7B14\u8BB0 frontmatter \u5206\u7C7B").settingEl.createDiv({text:""});r.style.opacity="0.8";let o=()=>{var w;let d=this.app.workspace.getActiveViewOfType(f.MarkdownView),b=d==null?void 0:d.file;if(!b){r.setText("\u672A\u68C0\u6D4B\u5230\u6D3B\u52A8\u7B14\u8BB0");return}let S=((w=this.app.metadataCache.getFileCache(b))==null?void 0:w.frontmatter)||{},c=S.sort_id!=null?Number(S.sort_id):null;if(!c){r.setText("\u672A\u8BBE\u7F6E\uFF08frontmatter \u4E2D\u65E0 sort_id\uFF09");return}let l=this.plugin.getSortNameByIdPublic(c);l?r.setText(`${l} (ID: ${c})`):r.setText(`\u672A\u5339\u914D\u5230\u5206\u7C7B (ID: ${c})\uFF0C\u8BF7\u5148\u70B9\u51FB\u4E0A\u65B9\u201C\u5237\u65B0\u5206\u7C7B\u201D`)};o(),this.plugin.settings.baseUrl&&this.plugin.refreshSortOptions().then(()=>{this.plugin.populateSortDropdown(e),e.setValue(this.plugin.settings.defaultSortId||""),o()}).catch(()=>{}),this.didRegisterLiveUpdates||(this.plugin.registerEvent(this.app.workspace.on("active-leaf-change",()=>o())),this.plugin.registerEvent(this.app.metadataCache.on("changed",()=>o())),this.didRegisterLiveUpdates=!0)}},K=class extends f.ItemView{constructor(t,s){super(t);this.plugin=s}getViewType(){return G}getDisplayText(){return"EMLOG \u53D1\u5E03"}getIcon(){return"paper-plane"}async onOpen(){let{contentEl:t}=this;t.empty(),t.createEl("h3",{text:"EMLOG \u64CD\u4F5C\u9762\u677F"});let s=t.createDiv({cls:"emlog-panel-actions"}),e=s.createEl("button",{text:"\u53D1\u5E03\uFF08\u6B63\u5F0F\uFF09"}),i=s.createEl("button",{text:"\u53D1\u5E03\u4E3A\u8349\u7A3F"}),r=s.createEl("button",{text:"\u53D1\u5E03\u5FAE\u8BED\uFF08\u9009\u4E2D\u6587\u672C\uFF09"}),o=s.createEl("button",{text:"\u5237\u65B0\u5206\u7C7B"}),d=s.createEl("button",{text:"\u6253\u5F00\u8BBE\u7F6E"}),b=s.createEl("button",{text:"\u81EA\u5B9A\u4E49\u53D1\u5E03\u2026"}),S=t.createEl("div",{cls:"emlog-panel-log"});S.setAttr("style","margin-top:8px;font-size:12px;opacity:.85;white-space:pre-wrap;");let c=l=>{S.setText(`[${new Date().toLocaleTimeString()}] ${l}`)};e.onclick=async()=>{c("\u53D1\u5E03\u4E2D..."),await this.plugin.publishCurrentNote(!1)},i.onclick=async()=>{c("\u8349\u7A3F\u53D1\u5E03\u4E2D..."),await this.plugin.publishCurrentNote(!0)},r.onclick=async()=>{c("\u53D1\u5E03\u5FAE\u8BED\u4E2D..."),await this.plugin.publishNote()},o.onclick=async()=>{c("\u5237\u65B0\u5206\u7C7B\u4E2D..."),await this.plugin.refreshSortOptions(),c("\u5206\u7C7B\u5DF2\u5237\u65B0")},d.onclick=()=>{var l;return(l=this.app.setting)==null?void 0:l.open()},b.onclick=()=>{var l;return this.plugin.openPublishModal(((l=this.app.workspace.getActiveViewOfType(f.MarkdownView))==null?void 0:l.file)||this.plugin.lastMarkdownFile)}}async onClose(){this.contentEl.empty()}},q=class extends f.Modal{constructor(t,s,e,i){super(t);this.title="";this.sortId="";this.tags="";this.excerpt="";this.draft=!1;this.postDate="";this.coverImage="";this.top=!1;this.sortop=!1;this.allowRemark=!0;this.password="";this.plugin=s,this.file=e,this.editor=i}async onOpen(){var d,b,S;let{contentEl:t,modalEl:s}=this;s.addClass("mod-publish-emlog"),t.empty(),t.createEl("h3",{text:"\u81EA\u5B9A\u4E49\u53D1\u5E03\u5230 EMLOG"});let e=this.editor?this.editor.getValue():await this.app.vault.cachedRead(this.file),i=this.plugin.extractFrontmatter(this.file)||{};this.title=this.plugin.deriveTitle(e,this.file,i),this.excerpt=this.plugin.deriveExcerpt(e,i),this.tags=Array.isArray(i.tags)?i.tags.map(String).join(","):typeof i.tags=="string"?i.tags:"",this.sortId=((d=i.sort_id)!=null?d:this.plugin.settings.defaultSortId)?String((b=i.sort_id)!=null?b:this.plugin.settings.defaultSortId):"",this.draft=i.draft==="y"||i.draft===!0||this.plugin.settings.defaultDraft,this.coverImage=i.cover_image||i.coverImage||"",this.top=i.top==="y"||i.top===!0||!1,this.sortop=i.sortop==="y"||i.sortop===!0||!1,this.allowRemark=i.allow_remark!=="n"&&i.allow_remark!==!1,this.password=i.password||"",new f.Setting(t).setName("\u6807\u9898").addText(c=>c.setValue(this.title).onChange(l=>this.title=l)),new f.Setting(t).setName("\u6458\u8981").addTextArea(c=>c.setValue(this.excerpt).onChange(l=>this.excerpt=l)),new f.Setting(t).setName("\u6807\u7B7E\uFF08\u9017\u53F7\u5206\u9694\uFF09").addText(c=>c.setValue(this.tags).onChange(l=>this.tags=l)),new f.Setting(t).setName("\u5C01\u9762\u56FE").setDesc("\u56FE\u7247URL\u6216\u672C\u5730\u56FE\u7247\u8DEF\u5F84").addText(c=>c.setValue(this.coverImage).onChange(l=>this.coverImage=l));let r=new f.Setting(t).setName("\u5206\u7C7B"),o=document.createElement("select");if(o.appendChild(new Option("\uFF08\u4E0D\u6307\u5B9A\uFF09","")),(S=this.plugin.cachedSorts)!=null&&S.length)for(let c of this.plugin.cachedSorts){let l=" ".repeat(c.depth*2);o.appendChild(new Option(`${l}${c.name}`,String(c.id)))}o.value=this.sortId,o.onchange=()=>this.sortId=o.value||"",r.settingEl.appendChild(o),new f.Setting(t).addButton(c=>c.setButtonText("\u5237\u65B0\u5206\u7C7B").onClick(async()=>{for(await this.plugin.refreshSortOptions();o.firstChild;)o.removeChild(o.firstChild);o.appendChild(new Option("\uFF08\u4E0D\u6307\u5B9A\uFF09",""));for(let l of this.plugin.cachedSorts){let w=" ".repeat(l.depth*2);o.appendChild(new Option(`${w}${l.name}`,String(l.id)))}this.sortId&&(o.value=this.sortId)})),new f.Setting(t).setName("\u8349\u7A3F").addToggle(c=>c.setValue(this.draft).onChange(l=>this.draft=l)),new f.Setting(t).setName("\u53D1\u5E03\u65F6\u95F4\uFF08\u53EF\u9009\uFF09").setDesc("\u683C\u5F0F\uFF1AYYYY-MM-DD HH:mm:ss").addText(c=>c.setPlaceholder("2025-08-15 10:00:00").onChange(l=>this.postDate=l)),new f.Setting(t).setName("\u9996\u9875\u7F6E\u9876").setDesc("\u662F\u5426\u5728\u9996\u9875\u7F6E\u9876\u663E\u793A\u6B64\u6587\u7AE0").addToggle(c=>c.setValue(this.top).onChange(l=>this.top=l)),new f.Setting(t).setName("\u5206\u7C7B\u7F6E\u9876").setDesc("\u662F\u5426\u5728\u5206\u7C7B\u9875\u9762\u7F6E\u9876\u663E\u793A\u6B64\u6587\u7AE0").addToggle(c=>c.setValue(this.sortop).onChange(l=>this.sortop=l)),new f.Setting(t).setName("\u5141\u8BB8\u8BC4\u8BBA").setDesc("\u662F\u5426\u5141\u8BB8\u8BFB\u8005\u5BF9\u6B64\u6587\u7AE0\u8FDB\u884C\u8BC4\u8BBA").addToggle(c=>c.setValue(this.allowRemark).onChange(l=>this.allowRemark=l)),new f.Setting(t).setName("\u8BBF\u95EE\u5BC6\u7801").setDesc("\u8BBE\u7F6E\u6587\u7AE0\u8BBF\u95EE\u5BC6\u7801\uFF08\u53EF\u9009\uFF09").addText(c=>c.setPlaceholder("\u7559\u7A7A\u8868\u793A\u65E0\u5BC6\u7801").setValue(this.password).onChange(l=>this.password=l)),new f.Setting(t).addButton(c=>c.setCta().setButtonText("\u53D1\u5E03").onClick(async()=>{let l=this.editor?this.editor.getValue():await this.app.vault.cachedRead(this.file);await this.plugin.publishCore(this.file,l,!1,{title:this.title,excerpt:this.excerpt,tags:this.tags,sortId:this.sortId,draft:this.draft,postDate:this.postDate||void 0,coverImage:this.coverImage||void 0,top:this.top?"y":"n",sortop:this.sortop?"y":"n",allowRemark:this.allowRemark?"y":"n",password:this.password||void 0}),this.close()}))}};
